<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Yasmin, Be My Valentine üíñ</title>
  <style>
    :root{--bg1:#ff9a9e;--bg2:#fad0c4;--accent:#ff4d6d}
    html,body{height:100%;margin:0}
    body{font-family:system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--bg1),var(--bg2));padding:18px}
    .card{background:rgba(255,255,255,0.96);border-radius:18px;padding:18px;max-width:520px;width:100%;box-shadow:0 20px 50px rgba(0,0,0,0.16);text-align:center;position:relative;overflow:hidden}
    video{width:100%;border-radius:12px;display:block;margin-bottom:14px;background:#000}
    h1{color:var(--accent);margin:8px 0;font-size:1.5rem}
    p{color:#333;margin:8px 0;font-size:1rem}
    .controls{margin-top:14px;display:flex;gap:12px;justify-content:center;align-items:center}
    button{padding:12px 18px;border-radius:999px;border:none;font-size:16px;cursor:pointer;touch-action:manipulation;transition:transform .18s ease,left .3s ease,top .3s ease}
    .btn-primary{background:linear-gradient(135deg,#ff4d6d,#ff758f);color:#fff}
    .btn-ghost{background:#f3f3f3;color:#333}
    .hearts{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:1}
    .heart{position:absolute;font-size:20px;animation:rise linear forwards;will-change:transform,opacity}
    @keyframes rise{from{transform:translateY(100vh);opacity:1}to{transform:translateY(-10vh);opacity:0}}

    /* bear emoji styling */
    .bear { font-size:72px; line-height:1; margin:6px 0 10px; }

    /* letters (Y+V) container for flower animation */
    .lettersCanvasWrap { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; z-index:60; }
    .flower { position:absolute; transform:translate(-50%,-50%); transition: transform 900ms cubic-bezier(.2,.9,.2,1), opacity 900ms; font-size:18px; will-change: transform, opacity; }

    @media (max-width:420px){h1{font-size:1.25rem}.card{padding:14px}.bear{font-size:48px}}
  </style>
</head>
<body>
  <div class="hearts" id="hearts" aria-hidden="true"></div>

  <!-- Intro card -->
  <div class="card" id="introCard" aria-hidden="false">
    <video id="introVideo" autoplay muted loop playsinline>
      <source src="yasmin.mp4" type="video/mp4">
      Your browser does not support the video tag or the file is not available.
    </video>

    <h1>Hi Yasmine</h1>
    <p id="introText">It's been a long time coming, and I want to ask:</p>

    <div class="controls">
      <button id="nextBtn" class="btn-primary" aria-label="Next">Next</button>
    </div>
  </div>

  <!-- Question card -->
  <div class="card" id="questionCard" style="display:none" aria-hidden="true">
    <div class="bear" aria-hidden="true">üêª</div>
    <h1>Will you be my Valentine?</h1>
    <p id="messageText">If yes, press the heart. If not, press the broken heart ‚Äî I'll still smile. üòä</p>

    <div class="controls" id="buttonRow">
      <button id="yesBtn" class="btn-primary">Yes ‚ù§Ô∏è</button>
      <button id="noBtn" class="btn-ghost">No üíî</button>
    </div>
  </div>

  <!-- overlay for flower-letter animation -->
  <div class="lettersCanvasWrap" id="lettersWrap" style="display:none"></div>

  <script>
    // DOM references
    const introCard = document.getElementById('introCard');
    const questionCard = document.getElementById('questionCard');
    const nextBtn = document.getElementById('nextBtn');
    const yesBtn = document.getElementById('yesBtn');
    const noBtn = document.getElementById('noBtn');
    const messageText = document.getElementById('messageText');
    const heartsRoot = document.getElementById('hearts');
    const lettersWrap = document.getElementById('lettersWrap');

    let noCount = 0;
    let evasive = false;
    let yesScale = 1;

    // Safe playful messages
    const noMessages = [
      'Are you sure?',
      'Think again...',
      "Please don't say no...",
      'pretty pretty pretty please'
    ];

    // spawn floating symbols helper
    function spawnFloating(symbol = '‚ù§Ô∏è', count = 30, durationBase = 3.5) {
      for (let i = 0; i < count; i++) {
        const el = document.createElement('div');
        el.className = 'heart';
        el.textContent = symbol;
        const size = Math.round(12 + Math.random() * 28);
        el.style.fontSize = size + 'px';
        el.style.left = (Math.random() * 90) + 'vw';
        el.style.animationDuration = (durationBase + Math.random() * 3) + 's';
        heartsRoot.appendChild(el);
        setTimeout(() => { try { el.remove(); } catch(e){} }, (durationBase + 4) * 1000);
      }
    }

    // go to question
    nextBtn.addEventListener('click', () => {
      introCard.style.display = 'none';
      introCard.setAttribute('aria-hidden','true');
      questionCard.style.display = 'block';
      questionCard.setAttribute('aria-hidden','false');
      spawnFloating('üíû', 18, 3.2);
      // ensure layout is stable
      questionCard.style.position = 'relative';
    });

    // Move the No button to a random position inside questionCard
    function moveNoRandom() {
      const parent = questionCard.getBoundingClientRect();
      const btn = noBtn.getBoundingClientRect();
      const padding = 8;
      const maxLeft = Math.max(0, parent.width - btn.width - padding);
      const maxTop = Math.max(0, parent.height - btn.height - padding);
      const left = Math.random() * maxLeft;
      const top = Math.random() * maxTop;
      noBtn.style.left = left + 'px';
      noBtn.style.top = top + 'px';
      // when No moves, increase the Yes button
      yesScale = Math.min(4, yesScale + 0.12);
      yesBtn.style.transform = `scale(${yesScale})`;
    }

    noBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      noCount++;
      // update message
      const msgIndex = Math.min(noCount - 1, noMessages.length - 1);
      messageText.textContent = noMessages[msgIndex];

      if (noCount <= 3) {
        // shrink No and grow Yes
        const scaleDown = Math.max(0.28, 1 - noCount * 0.18);
        noBtn.style.transform = `scale(${scaleDown})`;
        yesScale = 1 + noCount * 0.18;
        yesBtn.style.transform = `scale(${yesScale})`;
      } else {
        // evasive behavior: No button starts to dodge when clicked, NOT moving on its own
        if (!evasive) {
          evasive = true;
          // position the No button absolutely at its current visual position
          const parentRect = questionCard.getBoundingClientRect();
          const btnRect = noBtn.getBoundingClientRect();
          // compute left/top relative to parent
          const left = btnRect.left - parentRect.left;
          const top = btnRect.top - parentRect.top;
          noBtn.style.position = 'absolute';
          noBtn.style.left = left + 'px';
          noBtn.style.top = top + 'px';
        }
        // Move/dodge now that it's evasive
        moveNoRandom();
      }

      // spawn broken hearts visual
      spawnFloating('üíî', 8, 2.6);
    });

    // also dodge on touchstart if evasive (makes tapping harder)
    noBtn.addEventListener('touchstart', (e) => {
      if (evasive) {
        e.preventDefault(); // prevent double click issues
        moveNoRandom();
      }
    }, {passive:false});

    // Yes button: celebration -> flowers form letters Y + V
    yesBtn.addEventListener('click', () => {
      // remove/hide question content and show final message after animation
      // run flower-to-letters animation
      runFlowerLetterAnimation(() => {
        // show final text (keeps last page text)
        questionCard.innerHTML = `\n        <h1>She said YES üíñ</h1>\n        <p>Happy Valentine's Day, Yasmine üå∑</p>\n        <p style="font-weight:600; margin-top:10px;">‚Äî Yours, Victor ‚ù§Ô∏è</p>\n        <p style="margin-top:8px; font-size:0.95rem; color:#666;">Take a screenshot to save this moment üì∏</p>\n      `;
      });
    });

    // gentle background floating effect
    setInterval(() => spawnFloating('‚ù§Ô∏è', 1, 8), 1000);

    /* Flower -> Letter animation:
       - create an offscreen canvas, draw a large "Y+V"
       - sample pixels where text exists
       - spawn flower emoji elements at random positions, then animate them to sampled positions
    */
    function runFlowerLetterAnimation(onComplete) {
      // Prepare canvas
      const canvasW = 300;
      const canvasH = 130;
      const canvas = document.createElement('canvas');
      canvas.width = canvasW;
      canvas.height = canvasH;
      const ctx = canvas.getContext('2d');

      // draw big text "Y+V"
      ctx.fillStyle = '#000';
      ctx.clearRect(0,0,canvasW,canvasH);
      ctx.font = 'bold 120px serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('Y+V', canvasW/2, canvasH/2 + 6);

      // sample pixel positions
      const img = ctx.getImageData(0,0,canvasW,canvasH).data;
      const positions = [];
      const sample = 6; // sample density
      for (let y=0; y<canvasH; y+=sample) {
        for (let x=0; x<canvasW; x+=sample) {
          const idx = (y*canvasW + x) * 4;
          const alpha = img[idx+3];
          if (alpha > 128) {
            positions.push({x, y});
          }
        }
      }

      if (positions.length === 0) {
        // fallback: just do a big flower burst
        spawnFloating('üå∏', 140, 3.2);
        setTimeout(onComplete, 1200);
        return;
      }

      // map canvas positions to viewport coordinates centered over the page
      const wrapRect = document.body.getBoundingClientRect();
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;

      // scale factor so text fills nicely
      const targetWidth = Math.min(window.innerWidth * 0.7, 520);
      const scale = targetWidth / canvasW;
      const targetHeight = canvasH * scale;

      // Show the overlay
      lettersWrap.style.display = 'block';

      // create flower elements for a subset of sampled positions (limit to e.g., 220)
      const maxFlowers = Math.min(positions.length, 220);
      // randomize selection to make it look organic
      shuffleArray(positions);
      const chosen = positions.slice(0, maxFlowers);

      // create elements and animate them
      let finished = 0;
      chosen.forEach((pos, i) => {
        const fx = centerX + (pos.x - canvasW/2) * scale + (Math.random()-0.5)*8;
        const fy = centerY + (pos.y - canvasH/2) * scale + (Math.random()-0.5)*8;

        const el = document.createElement('div');
        el.className = 'flower';
        // random flower emoji
        const flowers = ['üå∏','üå∑','üíê','üå∫','üåº'];
        el.textContent = flowers[Math.floor(Math.random()*flowers.length)];
        // start at random corner
        const startX = Math.random() * window.innerWidth;
        const startY = window.innerHeight + 40 + Math.random()*120;
        el.style.left = startX + 'px';
        el.style.top = startY + 'px';
        el.style.opacity = '0';
        el.style.transform = `translate(-50%,-50%) scale(${0.6 + Math.random()*0.8})`;
        lettersWrap.appendChild(el);

        // force reflow then animate to final pos
        requestAnimationFrame(() => {
          el.style.transition = `left ${900 + Math.random()*600}ms cubic-bezier(.2,.9,.2,1), top ${900 + Math.random()*600}ms cubic-bezier(.2,.9,.2,1), opacity 600ms`;
          el.style.left = fx + 'px';
          el.style.top = fy + 'px';
          el.style.opacity = '1';
        });

        // after arrival, count finished
        const totalDelay = 1200 + Math.random()*900;
        setTimeout(() => {
          finished++;
          if (finished === chosen.length) {
            // keep the flower letters visible for a short moment, then call onComplete
            setTimeout(() => {
              // optionally fade out the overlay flowers slowly
              setTimeout(() => {
                // cleanup overlay
                while (lettersWrap.firstChild) lettersWrap.removeChild(lettersWrap.firstChild);
                lettersWrap.style.display = 'none';
                if (typeof onComplete === 'function') onComplete();
              }, 900);
            }, 700);
          }
        }, totalDelay);
      });
    }

    // Utility: shuffle array
    function shuffleArray(a) {
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
  </script>
</body>
</html>